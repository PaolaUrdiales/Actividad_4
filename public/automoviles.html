<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Autom贸viles</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <h1>Autom贸viles Disponibles</h1>

    <!-- Bot贸n de Cerrar Sesi贸n con un ID para identificarlo f谩cilmente -->
    <button id="cerrar-sesion" onclick="cerrarSesion()" style="display: none;">Cerrar Sesi贸n</button>

    <div id="autos-container"></div>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            console.log("P谩gina de autom贸viles cargada"); //  Depuraci贸n

            const token = localStorage.getItem("token");
            const logoutBtn = document.getElementById("cerrar-sesion");

            try {
                //  Si no hay token, redirigir al login
                if (!token) {
                    alert("Debes iniciar sesi贸n primero");
                    window.location.href = "index.html";
                    return;
                }

                //  Mostrar el bot贸n de cerrar sesi贸n
                logoutBtn.style.display = "block";

                //  Petici贸n a la API para obtener los autos
                const response = await fetch("https://actividad-4.onrender.com/act4/carros", { // Cambiar si est谩 en producci贸n
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${token}`,
                        "Content-Type": "application/json"
                    }
                });

                if (!response.ok) {
                    throw new Error("No se pudo obtener la lista de autom贸viles");
                }

                const autos = await response.json();
                console.log("Autos recibidos:", autos); //  Depuraci贸n

                const container = document.getElementById("autos-container");

                if (autos.length === 0) {
                    container.innerHTML = "<p>No hay autom贸viles disponibles.</p>";
                } else {
                    autos.forEach(auto => {
                        const autoElement = document.createElement("div");
                        autoElement.classList.add("auto-item");
                        autoElement.innerHTML = `
                            <h3>${auto.marca} ${auto.modelo}</h3>
                            <p>A帽o: ${auto.a帽o}</p>
                            <p>Precio: $${auto.precio}</p>
                            <p>Descripci贸n: ${auto.descripcion}</p>
                            <hr>
                        `;
                        container.appendChild(autoElement);
                    });
                }
            } catch (error) {
                console.error("Error:", error);
                alert("Hubo un problema al obtener los autom贸viles");
            }
        });

        function cerrarSesion() {
            console.log("Cerrando sesi贸n..."); //  Depuraci贸n
            localStorage.removeItem("token"); //  Elimina el token
            alert("Sesi贸n cerrada correctamente");
            window.location.href = "index.html"; //  Redirige al login inmediatamente
        }
    </script>
</body>
</html>

